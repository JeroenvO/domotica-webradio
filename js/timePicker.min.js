timePicker.prototype.draw=function(drawHandles){if(this.changed){this.ctx.save();this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.beginPath();this.ctx.rect(0,0,2*this.centerX,2*this.centerY);this.ctx.closePath();this.ctx.fillStyle=this.bgcolor;this.ctx.fill();this.ctx.translate(this.centerX,this.centerY);this.ctx.beginPath();this.ctx.arc(0,0,this.scale*4,0,2*Math.PI,false);this.ctx.closePath();this.ctx.fillStyle='rgba(22,22,22,1)';this.ctx.fill();this.ctx.beginPath();this.ctx.arc(0,0,this.scale*3,0,2*Math.PI,false);this.ctx.closePath();this.ctx.fillStyle='rgba(14,14,14,1)';this.ctx.fill();if(this.hSnd){this.ctx.beginPath();this.ctx.arc(0,0,this.scale*3,0,2*Math.PI,false);this.ctx.closePath();this.ctx.fillStyle=this.hColor;this.ctx.fill();}
this.ctx.beginPath();this.ctx.arc(0,0,this.scale*2,0,2*Math.PI,false);this.ctx.closePath();this.ctx.fillStyle='rgba(10,10,10,1)';this.ctx.fill();this.ctx.lineWidth=this.scale;this.ctx.beginPath();this.ctx.strokeStyle=this.mColor;this.ctx.arc(0,0,this.scale*3+this.scale/2,-0.5*Math.PI,this.mA,false);this.ctx.stroke();this.ctx.closePath();this.ctx.beginPath();this.ctx.strokeStyle=this.hSnd?this.hColor2:this.hColor;this.ctx.arc(0,0,this.scale*2+this.scale/2,-0.5*Math.PI,this.hA,false);this.ctx.stroke();this.ctx.closePath();var fontSize=this.scale*4/3;this.ctx.font=fontSize+"px Segoe UI light";var text=this.getTimeStr();this.ctx.textAlign='center';this.ctx.fillStyle='white';this.ctx.fillText(text,0,0+this.scale*2/5);if(drawHandles){handlesPos=this.getHandlers();this.ctx.save();this.ctx.rotate(this.mA);this.ctx.translate(this.scale*3+this.scale,0);this.drawHandle('m');this.ctx.restore();this.ctx.rotate(this.hA);this.ctx.translate(this.scale*2+this.scale,0);this.drawHandle('h');}
this.ctx.restore();}
this.changed=false;}
timePicker.prototype.drawHandle=function(handle){var lw=Math.round(this.scale/6.66667,0);this.ctx.beginPath();this.ctx.fillStyle='white'
this.ctx.moveTo(this.scale/20,-this.scale*3/20);this.ctx.lineTo(this.scale/20,this.scale*3/20);this.ctx.lineTo(-this.scale/10,0);this.ctx.fill();this.ctx.closePath();this.ctx.translate(this.scale/2,0);this.ctx.lineWidth=lw;this.ctx.beginPath();this.ctx.strokeStyle='white'
this.ctx.arc(0,0,this.scale/2-lw/2,0,2*Math.PI,false);this.ctx.closePath();this.ctx.stroke();this.ctx.fillStyle=(this.selected===handle)?'white':'rgba(38,38,38,1)';this.ctx.fill();}
timePicker.prototype.getMousePos=function(evt){var rect=this.canvas.getBoundingClientRect();return{x:evt.clientX-rect.left,y:evt.clientY-rect.top};}
timePicker.prototype.contains=function(xMouse,yMouse){handlersPos=this.getHandlers();if((Math.pow(handlersPos.xh-xMouse,2)+Math.pow(handlersPos.yh-yMouse,2))<=this.scale/2*this.scale/2)
return'h';if((Math.pow(handlersPos.xm-xMouse,2)+Math.pow(handlersPos.ym-yMouse,2))<=this.scale/2*this.scale/2)
return'm';else
return false;}
function getAngle(h,m){return{h:((h%12)/12*2-0.5)*Math.PI,m:((m%60)/60*2-0.5)*Math.PI,s:h>12?true:false};}
timePicker.prototype.setWidth=function(w,h,centerX,centerY,scale){this.canvas.width=w;this.canvas.heigth=h;this.centerX=centerX||w/2;this.centerY=centerY||h/2;this.scale=scale||Math.min(w,h)/10;this.changed=true;}
timePicker.prototype.animate=function(handler,endHours,endMinutes){this.tA=this[handler+'A'];var endAngle;if((typeof endHours==='number')&&(typeof endMinutes==='number')){endAngle=getAngle(endHours,endMinutes)[handler];}else{endAngle=getAngle(this.getTime().h,this.getTime().m)[handler];}
if(endAngle==-1/2*Math.PI&&this.tA>Math.PI){endAngle+=Math.PI*2}
var step=(endAngle-this.tA)/this.animationStep;var x=0;var timePicker=this;var intervalID=window.setInterval(function(){timePicker[handler+'A']+=step;timePicker[handler+'A']%=2*Math.PI;timePicker.changed=true;if(++x===timePicker.animationStep){window.clearInterval(intervalID);}},timePicker.drawInterval);}
timePicker.prototype.getHandlers=function(draw){return{xh:this.centerX+Math.cos(this.hA)*(this.scale*2+this.scale*3/2),yh:this.centerY+Math.sin(this.hA)*(this.scale*2+this.scale*3/2),xm:this.centerX+Math.cos(this.mA)*(this.scale*3+this.scale*3/2),ym:this.centerY+Math.sin(this.mA)*(this.scale*3+this.scale*3/2)};}
timePicker.prototype.getTime=function(){var offset=this.hSnd?12:0;return{h:(Math.round((this.hA+0.5*Math.PI)*6/Math.PI)+offset)%24,m:(Math.round((this.mA+0.5*Math.PI)*30/Math.PI))%60}}
timePicker.prototype.getTimeStr=function(){var t=this.getTime()
var zero=t.m.toString().length==1?'0':'';;var timeStr=(t.h+':'+zero+t.m.toString());return timeStr;}
timePicker.prototype.setTime=function(hours,minutes){this.hSnd=hours>12?true:false;this.animate('h',hours,minutes);this.animate('m',hours,minutes);}
timePicker.prototype.setSnd=function(my){var p=this.prevH;var a=this.hA+0.5*Math.PI;if(((p>=0&&a>Math.PI&&p<Math.PI)||(a>=0&&p>Math.PI&&a<Math.PI))&&(my<this.centerY)){this.hSnd=!this.hSnd;}
this.prevH=a;}
timePicker.prototype.startDraw=function(){if(!this.drawID){var timePicker=this;this.drawID=setInterval(function(){timePicker.draw(timePicker.drawHandles);},timePicker.drawInterval);}}
timePicker.prototype.stopDraw=function(){if(this.drawID){clearInterval(this.drawID);this.drawID=false;}}
timePicker.prototype.setColor=function(color){switch(color){case'pink':color={m:'rgba(255,42,126,1)',h:'rgba(177,0,55,1)',h2:'rgba(124,0,39,1)'};break;case'green':color={m:'rgba(97,164,0,1)',h:'rgba(0,74,0,1)',h2:'rgba(0,52,0,1)'};break;case'orange':color={m:'rgba(255,99,0,1)',h:'rgba(128,0,0,1)',h2:'rgba(90,0,0,1)'};break;case'blue':color={m:'rgba(0,164,164,1)',h:'rgba(0,69,87,1)',h2:'rgba(0,48,61,1)'};break;}
this.hColor=color.h;this.mColor=color.m;this.hColor2=color.h2;this.changed=true;}
function timePicker(canvas,opts){this.canvas=canvas;this.ctx=canvas.getContext('2d');var timePicker=this;this.hA=0;this.mA=0;this.tA=0;this.changed=true;this.setWidth(canvas.width,canvas.height,opts.centerX||false,opts.centerY||false,opts.scale||false);this.drawHandles=(typeof opts.drawHandles==='undefined'||opts.drawHandles==true)?true:false;if(opts.color)this.setColor(opts.color);this.animationStep=opts.animationStep||5;this.drawInterval=opts.drawInterval||10;this.onTimeChange=opts.onTimeChange||false;this.onCenterClick=opts.onCenterClick||false;this.setTime(opts.hours,opts.minutes);this.bgcolor=opts.bgcolor||'rgba(29,29,29,1)';if((typeof opts.autoStartDraw==='undefined')||opts.autoStartDraw==true){this.drawID=setInterval(function(){timePicker.draw(timePicker.drawHandles);},timePicker.drawInterval);}else{this.drawID=false;}
canvas.addEventListener('mousedown',function(e){if(timePicker.drawHandles&&document.body.contains(timePicker.canvas)){var mouse=timePicker.getMousePos(e);timePicker.selected=timePicker.contains(mouse.x,mouse.y);timePicker.changed=true;}});canvas.addEventListener('mousemove',function(e){if(timePicker.selected&&document.body.contains(timePicker.canvas)){if(timePicker.onTimeChange){timePicker.onTimeChange();}
var mouse=timePicker.getMousePos(e);var mx=mouse.x;var my=mouse.y;var angle=Math.atan((my-timePicker.centerY)/(mx-timePicker.centerX));if(mx<timePicker.centerX){angle=angle+Math.PI};if(timePicker.selected=='h'){timePicker.setSnd(my)};timePicker[timePicker.selected+'A']=angle;timePicker.changed=true;}});canvas.addEventListener('mouseup',function(e){if(timePicker.selected&&document.body.contains(timePicker.canvas)){timePicker.animate(timePicker.selected,true);timePicker.selected=false;timePicker.changed=true;}
if(timePicker.onCenterClick&&document.body.contains(timePicker.canvas)){var mouse=timePicker.getMousePos(e);if((Math.pow(timePicker.centerX-mouse.x,2)+Math.pow(timePicker.centerY-mouse.y,2))<timePicker.scale*timePicker.scale*4){timePicker.onCenterClick();}}});}